<div class="container mt-4" *ngIf="!vistaClases">
  <header class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="page-title">Gesti√≥n de Cursos</h1>
      <p class="user-type-badge" [class]="usuario.tipo === 'profesor' ? 'badge-profesor' : 'badge-estudiante'">
        {{ usuario.tipo === 'profesor' ? 'Profesor' : 'Estudiante' }}
        <span *ngIf="usuario.nombre"> - {{ usuario.nombre }}</span>
      </p>
    </div>
    <div class="d-flex align-items-center gap-3">
      <div *ngIf="usuario.tipo === 'estudiante'" class="course-counter">
        {{ cursosAgregadosCount }}/4 cursos agregados
      </div>

      <div *ngIf="usuario.tipo === 'profesor'" class="course-counter">
        {{ cursosPredefinidos.length + cursosProfesor.length }}/15 cursos en sistema
      </div>

      <button *ngIf="usuario.tipo === 'profesor' && puedeAgregarCursos"
              class="btn btn-success"
              (click)="mostrarModalCrearCurso = true">
        <i class="bi bi-plus-circle"></i> Crear Curso
      </button>

      <button *ngIf="usuario.tipo === 'estudiante' && puedeAgregarCursos"
              class="btn btn-primary"
              (click)="mostrarModalAgregarCurso = true">
        <i class="bi bi-plus-circle"></i> Agregar Curso
      </button>

      <button class="btn btn-outline-danger logout-btn" (click)="salir()">
        <i class="bi bi-box-arrow-right"></i> Salir
      </button>
    </div>
  </header>

  <div *ngIf="cursosVisibles.length === 0" class="text-center py-5">
    <div class="empty-state">
      <i class="bi bi-book" style="font-size: 4rem; color: #6c757d;"></i>
      <h3 class="mt-3">No hay cursos disponibles</h3>
      <p *ngIf="usuario.tipo === 'profesor'" class="text-muted">
        ¬°Crea el primer curso del sistema!
      </p>
      <p *ngIf="usuario.tipo === 'estudiante'" class="text-muted">
        No hay cursos disponibles en este momento.
      </p>
    </div>
  </div>

  <div class="row" *ngIf="cursosVisibles.length > 0">
    <div *ngFor="let curso of cursosVisibles" class="col-md-6 col-lg-3 mb-4">
      <div class="course-card" [class.curso-agregado]="curso.agregado">
        <div class="course-header">
          <h3 class="course-title">{{ curso.nombre }}</h3>
          <div class="course-code">{{ curso.codigo }}</div>
          <div class="course-period">{{ curso.periodo }}</div>

          <div *ngIf="curso.creadoPor" class="curso-info-adicional">
            <small>Creado por: {{ curso.creadoPor }}</small>
            <small *ngIf="curso.fechaCreacion"> ‚Ä¢ {{ curso.fechaCreacion }}</small>
          </div>

          <div *ngIf="!curso.esDelSistema" class="badge-creado">Creado por Profesor</div>
        </div>

        <div class="course-actions">
          <a (click)="verClasesCurso(curso.id)" class="action-btn" style="cursor: pointer;">
            <i class="bi bi-book"></i>
            <span>Clases</span>
          </a>
          <!-- üîπ Redirecci√≥n din√°mica al presionar "Tareas" -->
          <a (click)="verTareasCurso(curso)" class="action-btn" style="cursor: pointer;">
            <i class="bi bi-clipboard-check"></i>
            <span>Tareas</span>
          </a>
          <a href="#" class="action-btn">
            <i class="bi bi-pencil-square"></i>
            <span>Quizzes</span>
          </a>
        </div>

        <div class="course-management" *ngIf="usuario.tipo === 'estudiante'">
          <button *ngIf="!curso.agregado && puedeAgregarCursos"
                  class="btn btn-sm btn-success w-100"
                  (click)="toggleCurso(curso.id)">
            <i class="bi bi-plus"></i> Agregar a Mi Cuenta
          </button>
          <button *ngIf="curso.agregado"
                  class="btn btn-sm btn-outline-danger w-100"
                  (click)="toggleCurso(curso.id)">
            <i class="bi bi-dash"></i> Quitar de Mi Cuenta
          </button>
        </div>

        <div class="course-management" *ngIf="usuario.tipo === 'profesor' && curso.creadoPor === usuario.nombre">
          <button class="btn btn-sm btn-outline-danger w-100"
                  (click)="eliminarCursoProfesor(curso.id)">
            <i class="bi bi-trash"></i> Eliminar Curso
          </button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="mostrarModalAgregarCurso" class="modal-overlay" (click)="mostrarModalAgregarCurso = false">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h5 class="modal-title">Agregar Cursos Disponibles</h5>
        <button type="button" class="btn-close" (click)="mostrarModalAgregarCurso = false">√ó</button>
      </div>
      <div class="modal-body">
        <div *ngFor="let curso of cursosVisibles" class="modal-course-item">
          <div class="course-info">
            <strong>{{ curso.nombre }}</strong>
            <small class="text-muted d-block">{{ curso.codigo }}</small>
            <small class="text-info" *ngIf="curso.creadoPor && curso.creadoPor !== 'Sistema'">
              Creado por: {{ curso.creadoPor }}
            </small>
          </div>

          <button *ngIf="!curso.agregado && puedeAgregarCursos"
                  class="btn btn-sm btn-success"
                  (click)="agregarCursoEstudiante(curso.id); mostrarModalAgregarCurso = false">
            Agregar
          </button>
          <span *ngIf="curso.agregado" class="badge bg-secondary">Ya agregado</span>
        </div>

        <div *ngIf="!puedeAgregarCursos" class="alert alert-warning mt-3">
          Has alcanzado el l√≠mite m√°ximo de 4 cursos.
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="mostrarModalCrearCurso" class="modal-overlay" (click)="mostrarModalCrearCurso = false">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h5 class="modal-title">Crear Nuevo Curso</h5>
        <button type="button" class="btn-close" (click)="mostrarModalCrearCurso = false">√ó</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="agregarCursoSistema()">
          <div class="mb-3">
            <label for="nombreCurso" class="form-label">Nombre del Curso *</label>
            <input type="text"
                  class="form-control"
                  id="nombreCurso"
                  [(ngModel)]="nuevoCurso.nombre"
                  name="nombreCurso"
                  required
                  placeholder="Ej: Inteligencia Artificial"
                  maxlength="100">
            <div class="form-text">M√°ximo 100 caracteres</div>
          </div>

          <div class="mb-3">
            <label for="codigoCurso" class="form-label">C√≥digo del Curso *</label>
            <input type="text"
                  class="form-control"
                  id="codigoCurso"
                  [(ngModel)]="nuevoCurso.codigo"
                  name="codigoCurso"
                  required
                  placeholder="Ej: 202615-16015"
                  pattern="[0-9-]+"
                  maxlength="20">
            <div class="form-text">Solo n√∫meros y guiones</div>
          </div>

          <div class="mb-3">
            <label for="periodoCurso" class="form-label">Per√≠odo Acad√©mico</label>
            <input type="text"
                  class="form-control"
                  id="periodoCurso"
                  [(ngModel)]="nuevoCurso.periodo"
                  name="periodoCurso"
                  placeholder="Ej: 202615 Sem Sep/Ene 25-26 PR"
                  maxlength="50">
          </div>

          <div class="alert alert-info">
            <small>
              <i class="bi bi-info-circle"></i>
              Este curso ser√° visible para todos los estudiantes del sistema.
            </small>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="mostrarModalCrearCurso = false">
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="!nuevoCurso.nombre || !nuevoCurso.codigo">
              Crear Curso
            </button>
          </div>
        </form>

        <div *ngIf="!puedeAgregarCursos" class="alert alert-warning mt-3">
          Has alcanzado el l√≠mite m√°ximo de 15 cursos en el sistema.
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Vista de Clases del Curso -->
<div class="container mt-4" *ngIf="vistaClases && cursoSeleccionado">
  <header class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <button class="btn btn-outline-secondary mb-2" (click)="volverACursos()">
        <i class="bi bi-arrow-left"></i> Volver a Cursos
      </button>
      <h1 class="page-title">{{ cursoSeleccionado.nombre }}</h1>
      <p class="text-muted">{{ cursoSeleccionado.codigo }} - {{ cursoSeleccionado.periodo }}</p>
    </div>
    <div class="d-flex align-items-center gap-3">
      <button *ngIf="usuario.tipo === 'profesor'" class="btn btn-success" (click)="crearNuevaClase()">
        <i class="bi bi-plus-circle"></i> Crear Clase
      </button>
      <button class="btn btn-outline-danger logout-btn" (click)="salir()">
        <i class="bi bi-box-arrow-right"></i> Salir
      </button>
    </div>
  </header>

  <!-- Clases existentes -->
  <div class="row" *ngIf="clasesDelCurso.length > 0">
    <div *ngFor="let clase of clasesDelCurso" class="col-md-6 col-lg-4 mb-4">
      <div class="clase-card">
        <div class="clase-header">
          <span class="clase-numero">Clase {{ clase.orden }}</span>
          <h4 class="clase-titulo">{{ clase.nombre }}</h4>
        </div>
        <div class="clase-body">
          <p class="clase-descripcion">{{ clase.descripcion }}</p>
          <div *ngIf="clase.recursos" class="clase-recursos">
            <small><i class="bi bi-link-45deg"></i> Recursos disponibles</small>
          </div>
        </div>
        <div class="clase-footer" *ngIf="usuario.tipo === 'profesor'">
          <button class="btn btn-sm btn-outline-danger" (click)="eliminarClase(clase.id)">
            <i class="bi bi-trash"></i> Eliminar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Placeholders de clases vac√≠as (en gris) -->
  <div class="row" *ngIf="clasesDelCurso.length === 0">
    <div class="col-12 text-center mb-4">
      <p class="text-muted">No hay clases creadas para este curso a√∫n.</p>
    </div>
    <div *ngFor="let item of clasesPlaceholder" class="col-md-6 col-lg-4 mb-4">
      <div class="clase-card clase-placeholder">
        <div class="clase-header">
          <span class="clase-numero">Sin clase</span>
          <h4 class="clase-titulo">Clase vac√≠a</h4>
        </div>
        <div class="clase-body">
          <p class="clase-descripcion text-muted">No hay contenido disponible</p>
        </div>
      </div>
    </div>
  </div>
</div>
